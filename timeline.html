<!--
    Copyright Fernando Pelliccioni 2019-2021

    Distributed under the Boost Software License, Version 1.0. (See accompanying
    file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
-->

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Math Timeline</title>
    <!-- <link href="/favicon.png" rel="icon"> -->
    <!-- <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:300&subset=latin,latin-ext' rel='stylesheet' type='text/css'> -->
    <!-- <link rel="stylesheet" href="{{ site.url }}/assets/css/algorithms/styles/monokai-sublime.css"> -->
    <link rel="stylesheet" href="./assets/css/style.css">
    <script src="./assets/js/two.min.js"></script>
</head>

<!-- <body> -->
<body style="height: 100%">
    <div id="sequence"></div>
    <script>
        var year_from = -5500;
        var year_to   =  2100;
        var year_from_x = 50;
        var year_step = 500;
        var background;
        var foreground;

        // var font_family = "FiraCode";
        // var defaultTextSize = 13;
        // var roundedRectangleWidthDelta = 40;
        // var textWidthFactor = 1;

        var font_family = "FellTypeRoman";
        var defaultTextSize = 20;
        var roundedRectangleWidthDelta = 0;
        var textWidthFactor = 0.9;

        function drawMultiText(two, fulltext, x, y, font, color, size) {
            var texts = fulltext.split('\n');

            for (var i = 0; i < texts.length; ++i) {
                var text_elem = two.makeText(texts[i], x, y);
                text_elem.family = font;
                text_elem.fill = color;
                text_elem.size = size;
                y += 20;
            }
        }

        function textWidht(text) {
            var textW = text.value.length * text.size * Two.Text.Ratio * textWidthFactor;
            return textW;
        }

        function textWidht2(value, fontSize) {
            var textW = value.length * fontSize * Two.Text.Ratio * textWidthFactor;
            return textW;
        }

        function drawDashedLine(two, x, topY, height, color) {
            var y = topY;
            var segmentHeight = 10;
            while (y < topY + height) {
                var line = two.makeRectangle(x, y, 3, segmentHeight);
                line.fill = color;
                line.stroke = color;
                line.linewidth = 0;
                line.opacity = 0.5;
                background.add(line);
                y += segmentHeight * 1.5;
            }

            var point = two.makeCircle(x, topY + height, 3);
            point.stroke = color;
            point.fill = color;
            // point.opacity = 0.5;
        }

        function drawPeriod(two, name, yearF, yearT, color, level) {
            var yearFX = yearX(two, yearF);
            var yearTX = yearX(two, yearT);
            var w = yearTX - yearFX;

            var x = yearFX + w / 2;
            var y = two.height / 2 + 50 * level;

            var line = two.makeRectangle(x, y, w, 10);
            line.fill = color;
            line.stroke = color;
            line.linewidth = 0;


            drawMultiText(two, name, x, y + 20, font_family, color, defaultTextSize + 3);
            // var text = two.makeText(name, x, y + 20);
            // text.family = font_family; //"Source Code Pro";
            // text.fill = color;
            // text.size = defaultTextSize + 3;
            // // text.alignment = 'left';
        }

        function drawYear(two, year, x, y) {
            // x = 30;
            // y = two.height / 2;

            var y_5500 = two.makeCircle(x, y, 5);
            y_5500.stroke = "white";
            y_5500.fill = "white";

            var text = two.makeText(year, x, y + 20);
            text.family = font_family; //"Source Code Pro";
            text.size = defaultTextSize;
            text.fill = 'white';

            if (year % 1000 == 0) {
                // text.style = 'bold';
                // text.weight = 2000;
                // text.linewidth = 2;
                text.size = text.size + 3;
            }

        }

        function drawEvent1(two, name, year, color, textColor, level) {
            var x = yearX(two, year);

            // var y = two.height / 2 - 150;
            var y = two.height / 2 - 100 * level;
            var fontSize = defaultTextSize + 3;

            var triangleUp = two.makePolygon(x, y - 25, 10); //, sides);
            triangleUp.fill = color;
            triangleUp.stroke = color;

            var triangleDown = two.makePolygon(x, y + 25, 10); //, sides);
            triangleDown.fill = color;
            triangleDown.stroke = color;
            triangleDown.rotation = Math.PI;

            var textW = textWidht2(name, fontSize);
            var rect = two.makeRoundedRectangle(x, y, textW + roundedRectangleWidthDelta, 40);
            rect.fill = color;
            rect.stroke = color;

            var text = two.makeText(name, x, y);
            text.family = font_family;
            text.fill = textColor;
            text.size = fontSize;

            var line = two.makeRectangle(x, y, 3, two.height * 2);
            line.fill = color;
            line.stroke = color;
            line.linewidth = 0;
            background.add(line);
        }

        function drawEvent2(two, name, year, color, textColor, level) {
            var x = yearX(two, year);

            // var y = two.height / 2 - 150;
            var y = two.height / 2 - 100 * level;
            var fontSize = defaultTextSize + 3;

            var triangleDown = two.makePolygon(x, y + 25, 10); //, sides);
            triangleDown.fill = color;
            triangleDown.stroke = color;
            triangleDown.rotation = Math.PI;

            var textW = textWidht2(name, fontSize);
            var rect = two.makeRoundedRectangle(x, y, textW + roundedRectangleWidthDelta, 40);
            rect.fill = color;
            rect.stroke = color;

            var text = two.makeText(name, x, y);
            text.family = font_family;
            text.fill = textColor;
            text.size = fontSize;

            var height = two.height / 2 - (y + 45) - 10;
            drawDashedLine(two, x, y + 45, height, color);
        }

        function yearX(two, year) {
            var years = year_to - year_from;
            // console.log(years);
            var steps = years / year_step;
            // console.log(steps);
            var real_width = two.width - year_from_x * 2;
            // console.log(real_width);
            // console.log(year);
            // console.log(year_from);
            // console.log(year - year_from);

            return year_from_x +
                   real_width * (year - year_from) / years;
        }

        function timeline1(two) {
            var line = two.makeRectangle(0, two.height / 2, two.width * 2, 5);
            line.fill = "white";
            line.linewidth = 0;

            var years = year_to - year_from;
            var steps = years / year_step;
            var x_step = (two.width - year_from_x * 2) / steps;

            var x = year_from_x;
            var y = two.height / 2;

            for (let year = year_from; year <= year_to; year += year_step) {
                var year_str = year == 0 ? "" : year;
                drawYear(two, year_str, x, y);

                // if (year == 0) {
                //     console.log("year 0 X: ", x);
                // }
                if (year == -5500) {
                    console.log("year -5500 X: ", x);
                }

                x += x_step;
            }

            var y0x = yearX(two, 0);
            var y0hole = two.makeRectangle(y0x, 0, 1, two.height * 2);
            y0hole.fill = "black";


            // Information ------------------------------------------------------------------------------------------------------------------------

            drawPeriod(two, 'Predynastic Egypt', -5500, -3160, '#a79b0b', 1);
            drawPeriod(two, 'Ancient Egypt', -3149, -332, '#a79b0b', 1);
            // drawPeriod(two, 'Classical Greece', -550, -323, '#1898e0', 2);
            // drawPeriod(two, 'Hellenistic period', -322, -31, '#1898e0', 3);
            drawPeriod(two, ' Ancient\nGreece', -550, -31, '#1898e0', 2);

            drawPeriod(two, 'Roman\nEmpire', -27, 476, '#1898e0', 2);

            drawPeriod(two, 'Middle Ages', 477, 1492, '#8a8f92', 2);

            // drawPeriod(two, 'Rashidun Caliphate', 632, 661, '#b15d42', 3);
            // drawPeriod(two, 'Umayyad Caliphate',  662, 750, '#b15d42', 4);
            // drawPeriod(two, 'Abbasid Caliphate',  751, 1517, '#b15d42', 3);
            drawPeriod(two, 'Caliphates', 632, 1517, '#b15d42', 3);


            drawEvent1(two, "First Algorithm", -2000, "#a79b0b", "white", 1);
            drawEvent2(two, "Moscow Mathematical Papyrus", -1850, "#a79b0b", "white", 2);
            drawEvent2(two, "Rhind Mathematical Papyrus", -1650, "#a79b0b", "white", 3);
            drawEvent2(two, "Pyramids", -2700, "#a79b0b", "white", 1);


            // drawEvent1(two, "Bitcoin: A P2P Electronic Cash System", 2008, "#0ac18e", "white", 1);       // 31-Oct-2008
            drawEvent1(two, "Bitcoin", 2008, "#0ac18e", "white", 1);       // 31-Oct-2008


            drawEvent1(two, "Marathon", -490, "#2850ce", "white", -3);

            two.update();
        }

        var iterators_colors = ['#afafff', '#ffaff7', '#fdffaf'
                                , '#affffb', '#ffe2af', '#d0afff', '#e1ffaf', '#ffafb9'];

        // var two_width = document.getElementById('hg-right-a').offsetWidth
        // var two_height = document.getElementById('hg-right-a').offsetHeight
        // console.log(two_width);
        // console.log(two_height);


        var two_width = document.getElementById('sequence').offsetWidth * 2;
        var two_height = document.getElementById('sequence').offsetHeight * 2;
        // console.log(two_width);
        // console.log(two_height);

        var two = new Two({
                fullscreen: true,
                // width: two_width,
                // height: two_height,
                autostart: true,
        }).appendTo(sequence);
        background = two.makeGroup();
        foreground = two.makeGroup();

        // console.log(two.width);
        // console.log(two.height);

        // var two_width = two.width;
        // var two_height = two.height;

        // var rect = two.makeRectangle(0, 0, two_width, two_height);
        // rect.fill = 'rgb(0, 200, 255)';
        // rect.opacity = 0.75;
        // rect.noStroke();


        // var line = two.makeLine(0,
        //                         two.height / 2,
        //                         two.width,
        //                         two.height / 2);
        // line.stroke = "white";

        timeline1(two);
    </script>
</body>
</html>


